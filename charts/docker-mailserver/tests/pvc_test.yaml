suite: pvc creation
templates:
  - pvc.yaml
values:
  - ../values.yaml
chart:
  version: 0.1.0
  appVersion: 0.1.0
tests:
  - it: should apply annotations from persistence.annotations
    set:
      persistence:
        mail-config:
          annotations:
            backup.banana.io/deltas: pancakes
    asserts:
      - matchSnapshot: { }

  - it: should create pvc of specified size
    set:
      persistence:
        mail-data:
          size: 1Pb
    documentIndex: 1
    asserts:
      - equal:
          path: spec.resources.requests.storage
          value: 1Pb

  - it: manifest should match snapshot
    asserts:
      - matchSnapshot: { }

  - it: should use subPath for volumes if defined
    set:
      persistence:
        mail-data:
          subPath: another-folder
    documentIndex: 1
    asserts:
      - equal:
          path: spec.template.spec.containers[0].volumeMounts[?(@.name=="mail-data")].subPath
          value: another-folder